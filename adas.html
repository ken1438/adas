<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MacroSim: Advanced AD-AS Model</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>body { font-family: 'Inter', sans-serif; }</style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;

        // --- Icons ---
        const Icons = {
            ArrowUp: (p) => <svg {...p} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m5 12 7-7 7 7"/><path d="M12 19V5"/></svg>,
            ArrowDown: (p) => <svg {...p} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 5v14"/><path d="m19 12-7 7-7-7"/></svg>,
            Minus: (p) => <svg {...p} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M5 12h14"/></svg>,
            Info: (p) => <svg {...p} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>,
            Refresh: (p) => <svg {...p} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>,
            Settings: (p) => <svg {...p} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,
            Activity: (p) => <svg {...p} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>,
            TrendingUp: (p) => <svg {...p} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>,
            Dollar: (p) => <svg {...p} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
            Globe: (p) => <svg {...p} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>,
            Users: (p) => <svg {...p} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        };

        const INITIAL_STATES = {
            equilibrium: { id: 'equilibrium', label: 'Long Run Equilibrium', adOffset: 0, description: 'Economy is at full employment (Y = Yf).' },
            deflationary: { id: 'deflationary', label: 'Deflationary Gap', adOffset: -30, description: 'Economy is below potential (Y < Yf). High unemployment.' },
            inflationary: { id: 'inflationary', label: 'Inflationary Gap', adOffset: 30, description: 'Economy is above potential (Y > Yf). Labor shortage.' }
        };

        const VIEW_MODES = {
            short_run: { id: 'short_run', label: 'Short Run Effect Only' },
            adjustment: { id: 'adjustment', label: 'Adjustment Process (Market Force)' },
            long_run: { id: 'long_run', label: 'Final Long Run Equilibrium' }
        };

        const SCENARIOS = [
            { 
                id: 'none', title: 'No Shock (Baseline)', type: 'neutral', ad: 0, sras: 0, lras: 0, desc: 'Observe the initial state.',
                impacts: { price: 'Stable', output: 'Stable', unemploy: 'Stable', interest: 'Stable', tax: 'Stable', trade: 'Stable' }
            },
            { 
                id: 'property_boom', title: 'Demand Shock: Property Boom', type: 'demand', ad: 25, sras: 0, lras: 0, desc: 'Wealth effect increases consumption.',
                impacts: { price: 'Increase', output: 'Increase', unemploy: 'Decrease', interest: 'Increase', tax: 'Increase', trade: 'Decrease' }
            },
            { 
                id: 'financial_volatility', title: 'Demand Shock: Financial Volatility', type: 'demand', ad: -25, sras: 0, lras: 0, desc: 'Risk rises, asset demand for money rises, r rises, I falls.',
                impacts: { price: 'Decrease', output: 'Decrease', unemploy: 'Increase', interest: 'Increase', tax: 'Decrease', trade: 'Increase' }
            },
            { 
                id: 'omo_purchase', title: 'Monetary: OMO Purchase', type: 'demand', ad: 25, sras: 0, lras: 0, desc: 'Money supply up, interest rate down, I & C up.',
                impacts: { price: 'Increase', output: 'Increase', unemploy: 'Decrease', interest: 'Decrease', tax: 'Increase', trade: 'Decrease' }
            },
            { 
                id: 'omo_sale', title: 'Monetary: OMO Sale', type: 'demand', ad: -25, sras: 0, lras: 0, desc: 'Money supply down, interest rate up, I & C down.',
                impacts: { price: 'Decrease', output: 'Decrease', unemploy: 'Increase', interest: 'Increase', tax: 'Decrease', trade: 'Increase' }
            },
            { 
                id: 'tax_increase', title: 'Fiscal: Increase Income Tax', type: 'demand', ad: -25, sras: 0, lras: 0, desc: 'Disposable income falls, C falls.',
                impacts: { price: 'Decrease', output: 'Decrease', unemploy: 'Increase', interest: 'Decrease', tax: 'Uncertain', trade: 'Increase' }
            },
            { 
                id: 'migration_out', title: 'Supply: Migration Abroad', type: 'supply', ad: 0, sras: -20, lras: -20, desc: 'Labor force shrinks, capacity falls.',
                impacts: { price: 'Increase', output: 'Decrease', unemploy: 'Increase', interest: 'Uncertain', tax: 'Decrease', trade: 'Decrease' }
            },
            { 
                id: 'oil_shock', title: 'Supply: Oil Price Hike', type: 'supply', ad: 0, sras: -25, lras: 0, desc: 'Production costs rise.',
                impacts: { price: 'Increase', output: 'Decrease', unemploy: 'Increase', interest: 'Uncertain', tax: 'Decrease', trade: 'Decrease' }
            },
            { 
                id: 'infrastructure', title: 'Fiscal: Infrastructure', type: 'mixed', ad: 20, sras: 15, lras: 15, desc: 'G rises (AD up) and Productivity rises (AS up).',
                impacts: { price: 'Uncertain', output: 'Increase', unemploy: 'Decrease', interest: 'Increase', tax: 'Increase', trade: 'Decrease' }
            }
        ];

        const ImpactCard = ({ label, value, icon: Icon }) => {
            let color = "text-slate-500 bg-slate-50";
            if (value === 'Increase') color = "text-green-700 bg-green-50 border-green-100";
            if (value === 'Decrease') color = "text-red-700 bg-red-50 border-red-100";
            if (value === 'Uncertain') color = "text-amber-700 bg-amber-50 border-amber-100";

            return (
                <div className={`flex items-center justify-between p-2 rounded border ${color}`}>
                    <div className="flex items-center gap-2">
                        <Icon className="w-4 h-4 opacity-75" />
                        <span className="text-xs font-semibold uppercase">{label}</span>
                    </div>
                    <span className="text-sm font-bold">{value}</span>
                </div>
            );
        };

        const ADASChart = ({ initialState, scenario, viewMode }) => {
            const width = 500, height = 350, padding = 40;
            const center = { x: width / 2, y: height / 2 };
            const slope = (height - 2 * padding) / (width - 2 * padding);

            const initAdShift = INITIAL_STATES[initialState].adOffset;
            const initSrasShift = 0; 

            const shockAd = scenario.ad;
            const shockSras = scenario.sras;
            const shockLras = scenario.lras;

            const srAdShift = initAdShift + shockAd;
            const srSrasShift = initSrasShift + shockSras;
            
            const getEq = (adS, srasS) => ({ 
                x: center.x + (adS + srasS) / 2, 
                y: center.y - slope * (adS - srasS) / 2 
            });
            
            // Adjustment Logic
            const srY_relative = (srAdShift + srSrasShift) / 2; 
            const gap = srY_relative - shockLras; 
            const adjustmentNeeded = -gap * 2; 
            const finalSrasShift = srSrasShift + adjustmentNeeded;

            let activeAd = srAdShift;
            let activeSras = srSrasShift;
            let ghostAd = initAdShift;
            let ghostSras = initSrasShift;
            let ghostLabel = "Initial";

            if (viewMode === 'adjustment' || viewMode === 'long_run') {
                ghostAd = srAdShift;
                ghostSras = srSrasShift;
                activeSras = finalSrasShift;
                ghostLabel = "Short Run";
            }

            const getLine = (type, shift) => {
                if (type === 'LRAS') return { x1: center.x + shift, y1: padding, x2: center.x + shift, y2: height - padding };
                if (type === 'AD') return { x1: padding + shift, y1: padding, x2: width - padding + shift, y2: height - padding };
                if (type === 'SRAS') return { x1: padding + shift, y1: height - padding, x2: width - padding + shift, y2: padding };
            };

            const lrasCoords = getLine('LRAS', shockLras);
            const adActive = getLine('AD', activeAd);
            const srasActive = getLine('SRAS', activeSras);
            const adGhost = getLine('AD', ghostAd);
            const srasGhost = getLine('SRAS', ghostSras);

            const showGhost = scenario.id !== 'none' || viewMode !== 'short_run' || initialState !== 'equilibrium';

            const eqActive = getEq(activeAd, activeSras);
            const eqGhost = getEq(ghostAd, ghostSras);
            
            // Calculate Adjustment Arrow for Long Run
            const eqSR = getEq(srAdShift, srSrasShift);
            const eqLR = getEq(srAdShift, finalSrasShift);

            return (
                <svg width="100%" height="100%" viewBox={`0 0 ${width} ${height}`} className="overflow-visible font-sans">
                    <line x1={padding} y1={height-padding} x2={width-padding} y2={height-padding} stroke="black" strokeWidth="2" markerEnd="url(#arrow)" />
                    <line x1={padding} y1={height-padding} x2={padding} y2={padding} stroke="black" strokeWidth="2" markerEnd="url(#arrow)" />
                    <text x={width-padding} y={height-padding+30} fontWeight="bold" fontSize="14">Y</text>
                    <text x={padding-30} y={padding} fontWeight="bold" fontSize="14" style={{writingMode:'vertical-rl'}}>P</text>
                    <defs><marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto"><path d="M0,0 L0,6 L9,3 z" /></marker></defs>

                    <line x1={lrasCoords.x1} y1={lrasCoords.y1} x2={lrasCoords.x2} y2={lrasCoords.y2} stroke="#dc2626" strokeWidth="3" />
                    <text x={lrasCoords.x1} y={padding-10} fill="#dc2626" fontWeight="bold" textAnchor="middle">LRAS</text>

                    {showGhost && (
                        <>
                            <line x1={adGhost.x1} y1={adGhost.y1} x2={adGhost.x2} y2={adGhost.y2} stroke="#cbd5e1" strokeWidth="2" strokeDasharray="5,5" />
                            {activeAd !== ghostAd && <text x={adGhost.x2+5} y={adGhost.y2} fill="#94a3b8" fontSize="12">AD ({ghostLabel})</text>}
                            <line x1={srasGhost.x1} y1={srasGhost.y1} x2={srasGhost.x2} y2={srasGhost.y2} stroke="#cbd5e1" strokeWidth="2" strokeDasharray="5,5" />
                            {activeSras !== ghostSras && <text x={srasGhost.x2+5} y={srasGhost.y2} fill="#94a3b8" fontSize="12">SRAS ({ghostLabel})</text>}
                            <circle cx={eqGhost.x} cy={eqGhost.y} r="4" fill="#cbd5e1" />
                        </>
                    )}

                    <line x1={adActive.x1} y1={adActive.y1} x2={adActive.x2} y2={adActive.y2} stroke="#16a34a" strokeWidth="3" className="transition-all duration-700" />
                    <text x={adActive.x2} y={adActive.y2} fill="#16a34a" fontWeight="bold">AD</text>

                    <line x1={srasActive.x1} y1={srasActive.y1} x2={srasActive.x2} y2={srasActive.y2} stroke="#2563eb" strokeWidth="3" className="transition-all duration-700" />
                    <text x={srasActive.x2} y={srasActive.y2} fill="#2563eb" fontWeight="bold">SRAS</text>

                    <circle cx={eqActive.x} cy={eqActive.y} r="6" fill="#7c3aed" />
                    <text x={eqActive.x} y={eqActive.y - 15} textAnchor="middle" fontWeight="bold" fill="#7c3aed">E</text>

                    {viewMode === 'adjustment' && Math.abs(eqLR.x - eqSR.x) > 5 && (
                        <path d={`M ${eqSR.x} ${eqSR.y} L ${eqLR.x} ${eqLR.y}`} stroke="#94a3b8" strokeWidth="2" strokeDasharray="4,4" markerEnd="url(#arrow)" />
                    )}
                </svg>
            );
        };

        function App() {
            const [initialState, setInitialState] = useState('equilibrium');
            const [scenarioId, setScenarioId] = useState('none');
            const [viewMode, setViewMode] = useState('short_run');

            const scenario = SCENARIOS.find(s => s.id === scenarioId);

            const analysis = useMemo(() => {
                const initGap = INITIAL_STATES[initialState].adOffset;
                const shockAd = scenario.ad;
                const shockSras = scenario.sras;
                const shockLras = scenario.lras;

                const srY = (initGap + shockAd + shockSras) / 2;
                const srGap = srY - shockLras; 

                let gapStatus = "Equilibrium";
                if (srGap > 2) gapStatus = "Inflationary Gap";
                if (srGap < -2) gapStatus = "Deflationary Gap";

                let adjText = "No adjustment needed.";
                if (srGap > 2) adjText = "Excess demand for factors (labor shortage) → Factor prices (wages) rise → SRAS decreases (shifts left) until Y = Yf.";
                if (srGap < -2) adjText = "Excess supply of factors (unemployment) → Factor prices (wages) fall → SRAS increases (shifts right) until Y = Yf.";

                return { gapStatus, adjText };
            }, [initialState, scenario]);

            return (
                <div className="min-h-screen p-4 md:p-8 max-w-7xl mx-auto">
                    <header className="mb-8 border-b pb-4">
                        <h1 className="text-3xl font-bold text-slate-800 flex items-center gap-3">
                            <Icons.Activity className="text-blue-600"/> MacroSim Advanced
                        </h1>
                        <p className="text-slate-500">AD-AS Model with Market Force Adjustments</p>
                    </header>

                    <div className="grid lg:grid-cols-12 gap-8">
                        <div className="lg:col-span-4 space-y-6">
                            <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                                <h3 className="font-bold text-slate-700 mb-3 flex items-center gap-2"><Icons.Settings className="w-4 h-4"/> 1. Initial Context</h3>
                                <div className="space-y-2">
                                    {Object.values(INITIAL_STATES).map(state => (
                                        <button key={state.id} onClick={() => setInitialState(state.id)} className={`w-full text-left p-3 rounded-lg text-sm border transition-all ${initialState === state.id ? 'bg-blue-50 border-blue-500 text-blue-700 ring-1 ring-blue-500' : 'hover:bg-slate-50 border-slate-200'}`}>
                                            <div className="font-semibold">{state.label}</div>
                                            <div className="text-xs opacity-75">{state.description}</div>
                                        </button>
                                    ))}
                                </div>
                            </div>
                            <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                                <h3 className="font-bold text-slate-700 mb-3 flex items-center gap-2"><Icons.Activity className="w-4 h-4"/> 2. Exogenous Shock</h3>
                                <select value={scenarioId} onChange={(e) => setScenarioId(e.target.value)} className="w-full p-2 border rounded-md bg-slate-50 text-sm font-medium focus:ring-2 focus:ring-blue-500 outline-none">
                                    {SCENARIOS.map(s => <option key={s.id} value={s.id}>{s.title}</option>)}
                                </select>
                                <p className="mt-3 text-sm text-slate-600 bg-slate-50 p-3 rounded border">{scenario.desc}</p>
                            </div>
                             <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                                <h3 className="font-bold text-slate-700 mb-3 flex items-center gap-2"><Icons.Refresh className="w-4 h-4"/> 3. Time Horizon</h3>
                                <div className="flex flex-col gap-2">
                                    {Object.values(VIEW_MODES).map(mode => (
                                        <button key={mode.id} onClick={() => setViewMode(mode.id)} className={`px-4 py-2 rounded text-sm font-medium border transition-colors ${viewMode === mode.id ? 'bg-purple-600 text-white border-purple-600' : 'bg-white text-slate-600 hover:bg-slate-50'}`}>
                                            {mode.label}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>
                        <div className="lg:col-span-8 space-y-6">
                            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                <ADASChart initialState={initialState} scenario={scenario} viewMode={viewMode} />
                            </div>
                            <div className="grid md:grid-cols-2 gap-6">
                                <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                                    <h4 className="font-bold text-slate-800 mb-4 border-b pb-2">Short Run Status</h4>
                                    <div className="mb-4 flex justify-between items-center">
                                        <span className="text-sm text-slate-500 font-medium">Output Gap:</span>
                                        <span className={`text-sm font-bold ${analysis.gapStatus.includes('Inflationary') ? 'text-red-600' : analysis.gapStatus.includes('Deflationary') ? 'text-blue-600' : 'text-green-600'}`}>{analysis.gapStatus}</span>
                                    </div>
                                    
                                    <h5 className="text-xs font-bold text-slate-400 uppercase mb-3 tracking-wider">Endogenous Variables (Shock Impact)</h5>
                                    <div className="grid grid-cols-2 gap-2">
                                        <ImpactCard label="Price Level" value={scenario.impacts.price} icon={Icons.Dollar} />
                                        <ImpactCard label="Real Output" value={scenario.impacts.output} icon={Icons.TrendingUp} />
                                        <ImpactCard label="Unemployment" value={scenario.impacts.unemploy} icon={Icons.Users} />
                                        <ImpactCard label="Interest Rate" value={scenario.impacts.interest} icon={Icons.Activity} />
                                        <ImpactCard label="Tax Revenue" value={scenario.impacts.tax} icon={Icons.Dollar} />
                                        <ImpactCard label="Trade Balance" value={scenario.impacts.trade} icon={Icons.Globe} />
                                    </div>
                                </div>
                                <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                                    <h4 className="font-bold text-slate-800 mb-2 border-b pb-2">Market Adjustment (Long Run)</h4>
                                    <p className="text-sm text-slate-600 leading-relaxed">{viewMode === 'short_run' ? "Switch view to 'Adjustment Process' to see how the market self-corrects." : analysis.adjText}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>